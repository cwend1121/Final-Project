//SPACE MONKEYS (copyright pending)
/*things to work on (problems for future us):
*space monkeys - cadence
*breaking the monkeys/aliens
*bullet limit
*/

//Constants For Monkeys
var NUM_ROWS = 5;
var num = Randomizer.nextInt(1, 3);
var MONKEY_RADIUS = 12;
var monkey;
var monkeyList = [];
var MONKEY_TOP_OFFSET = 10; 
var MONKEY_SPACING = MONKEY_RADIUS * 2;
var NUM_MONKEYS_PER_ROW = 10;
var SPACE_FOR_MONKEYS = getWidth() - (NUM_MONKEYS_PER_ROW + 1) * MONKEY_SPACING; 

//Constants For Bullet And Ship
const  SHIP_WIDTH = 80;
const  SHIP_HEIGHT = 15;
const  SHIP_OFFSET = 30;
const BULLET_RADIUS = 2;
var bullet;
var bulletList = []; 
var helicopter = new WebImage("https://static.codehs.com/img/library/objects/helicopter.png");

//Constants For Movement 
var ship;
var bulletTimer;
var dx = 4;
var dy = -4;
var vx = 10;
var vy = 10;
var startMovement = false;
var counter = 0;

//Constants For Timers And Score
var score = 0;
var numLives = 3;
var startGame = 10;
var winner = false;
var loser = true;

//Constants For Start Card
var backgroundStart = new Rectangle(getWidth(), getHeight());
backgroundStart.setPosition(0, 0); 
backgroundStart.setColor(Color.GREEN);
add(backgroundStart);
     
var txt = new Text("A group of space monkeys", "20pt Arial");
txt.setPosition(getWidth() / 10, 50);
txt.setColor(Color.BLACK);
add(txt);
    
var txt2 = new Text("are coming to attack Earth!", "20pt Arial");
txt2.setPosition(getWidth() / 10 - 3, 80);
txt2.setColor(Color.BLACK);
add(txt2);

var txt3 = new Text("Control the helicopter and shoot", "20pt Arial");
txt3.setPosition(10, getHeight() / 3);
txt3.setColor(Color.BLACK);
add(txt3);

var txt4 = new Text("them down for a prize worthy of", "20pt Arial");
txt4.setPosition(15, getHeight() / 3 + 30);
txt4.setColor(Color.BLACK);
add(txt4);

var txt5 = new Text("a hero... YOUR MOM", "20pt Arial");
txt5.setPosition(getWidth() / 4 - 25, getHeight() / 3 + 60);
txt5.setColor(Color.BLACK);
add(txt5);

var txt6 = new Text("Don't fail or else you will die.", "20pt Arial");
txt6.setPosition(30, getHeight() / 3 + 140);
txt6.setColor(Color.RED);
add(txt6);
        
var monkeyPicture = new WebImage("https://static.codehs.com/img/library/characters/monkey.jpg");
monkeyPicture.setSize(200, 160);
monkeyPicture.setPosition(getWidth() / 4, getHeight() - 170);
add(monkeyPicture);
        
var rect = new Rectangle(getWidth(), 30);
rect.setPosition(0, getHeight() / 2 - 15);
rect.setColor(Color.GREEN);
        
var backgroundStart2 = new Rectangle(getWidth(), getHeight());
backgroundStart2.setPosition(0, 0); 
backgroundStart2.setColor(Color.BLACK);
        
var txt7 = new Text("Presenting: Space Monkeys", "20pt Arial");
txt7.setPosition(getWidth() / 2 - 170, getHeight() / 2 + 9);
txt7.setColor(Color.WHITE);

function start(){
    setTimer(gameStart, 10);
}

function gameStart(){
    startGame--;
    if(startGame == 5){
        remove(backgroundStart); 
        remove(txt);
        remove(txt2);
        remove(txt3);
        remove(txt4);
        remove(txt5);
        remove(txt6);
        remove(monkeyPicture);
        
        add(backgroundStart2);
        add(rect);
        add(txt7);
    }
    if(startGame == 0){
        remove(backgroundStart2); 
        remove(rect);
        remove(txt7);
        
        startMovement = true;
        println("You can start the game");
        
        //Set Up The Game
        setBackground();
        setMonkeys(); 
        setScore();
        livesLeft();
        setTimer(moveMonkeys, 250);
    
        //Bullet And Ship Code
        drawShip();
        mouseMoveMethod(moveShip);
	    mouseClickMethod(drawBullet);
    }
    if(startGame == -1){
        println(startGame);
    }
}

//Adds Background
function setBackground(){
    var background = new Rectangle(getWidth(), getHeight());
    background.setPosition(0, 0); 
    background.setColor(Color.BLACK); 
    add(background);
    
    for(var i = 0; i < 40; i++){
        var x = Randomizer.nextInt(10, getWidth());
        var y = Randomizer.nextInt(10, getHeight());
        drawStars(x, y);
    }
}

function drawStars(x, y){
    var star = new Circle(1);
    star.setPosition(x, y);
    star.setColor(Color.WHITE);
    add(star);
}

//Sets Up Monkeys
function setMonkeys(){ 
    for (var r = 0; r < NUM_ROWS; r++){
        for (var c = 0; c < NUM_MONKEYS_PER_ROW; c++){
            monkey = new Circle(MONKEY_RADIUS);
            
            var monkeyX = MONKEY_SPACING + c * (MONKEY_RADIUS + MONKEY_SPACING);
            var monkeyY = MONKEY_TOP_OFFSET + r * (MONKEY_RADIUS + MONKEY_SPACING) + 40;
        
            monkey.setPosition(monkeyX, monkeyY); 
            if(num == 1){
                monkey.setColor((Color.randomGreen()));
            }else if(num == 2){
                monkey.setColor((Color.randomRed()));
            }else if(num == 3){
                monkey.setColor((Color.randomBlue()));
            }
            monkey.setBorderWidth(2);
            monkey.setBorderColor.GRAY;
            add(monkey);
            monkeyList.push(monkey); 
        }
    }
}

function setScore(){
    var txtScore = new Text("Score: " + score, "20pt Arial");
    txtScore.setPosition(5, 30);
    txtScore.setColor(Color.WHITE);
    add(txtScore);
}

function livesLeft(){
    var txtLives = new Text("Lives: " + numLives, "20pt Arial");
    txtLives.setPosition(getWidth() - 95, 30);
    txtLives.setColor(Color.WHITE);

    helicopter.setSize(10, 10);
    var monkeyElem = getElementAt(ship); 
    if(monkeyElem == monkey.getX()) {
        numLives--; 
    }
    if(numLives == 0) {
        gameOver();
    }
    
    add(txtLives);
    /*var lives = helicopter;
    var lives2 = helicopter;
    var lives3 = helicopter;
    lives.setPosition (20, 20);
    lives2.setPosition(40, 20);
    lives3.setPosition(60, 20);

    if(ship.getX() == monkeyList){
        numLives--;
    }
    if(numLives == 2){
        remove(lives3);
    }else if(numLives == 1){
        remove(lives2);
    }else if(numLives == 0){
        remove(lives);
        println("Game Over");
    }*/ 
}

//Moves Monkeys 
function moveMonkeys(){
    checkWall();
    moveHorizontal();
}

function moveHorizontal(){
    for(var i = 0; i < monkeyList.length; i++) {
        var movement = monkeyList[i];
           movement.move(vx, 0);
    }
}

function moveVertical(){
    for(var i = 0; i < monkeyList.length; i++){
        var movement = monkeyList[i];
        movement.move(0, vy);
        counter++;
        if(counter == 1){
            movement.move(0, vy);
            counter = 0;
        }
    }
}

//Getting A Game Over	
function gameOver(){
	var rectOver = new Rectangle(getWidth(), 30);
    rectOver.setPosition(0, getHeight() / 2 - 15);
    rectOver.setColor(Color.red);
    add(rectOver);
    
    var txtOver = new Text("Game Over. You Lose.", "20pt Arial");
    txtOver.setPosition(getWidth() / 2 - 130, getHeight() / 2 + 9);
    txtOver.setColor(Color.WHITE);
    add(txtOver);
}

function winGame(){
    var rectWin = new Rectangle(getWidth(), 30);
    rectWin.setPosition(0, getHeight() / 2 - 15);
    rectWin.setColor(Color.green);
    add(rectWin);
    
    var txtWin = new Text("You Win. Welcome to the Elite.", "20pt Arial");
    txtWin.setPosition(getWidth() / 2 - 180, getHeight() / 2 + 9);
    txtWin.setColor(Color.WHITE);
    add(txtWin);
}

//Spaceship Code
function drawShip(){
    ship = new WebImage("https://static.codehs.com/img/library/objects/helicopter.png");
    ship.setSize(40, 40);
    ship.setPosition(getWidth()/2 - SHIP_WIDTH/2, getHeight() - SHIP_OFFSET - SHIP_HEIGHT);
    add(ship);
}

//Move Ship
function moveShip(e){
    ship.setPosition(e.getX() - SHIP_WIDTH/2, getHeight() - SHIP_OFFSET - SHIP_HEIGHT);
}

//Shoots Bullets
function drawBullet(e){
    bullet = new Circle(BULLET_RADIUS);
    bullet.setPosition(ship.getX() + 20, ship.getY());
    bullet.setBorderWidth(2);
    bullet.setBorderColor(Randomizer.nextColor());
    add(bullet);
    //if(bulletTimer == false){
        setTimer(moveBullet, 10);
        //bulletTimer = true;
    //}
    bulletList.push(bullet);
}

function moveBullet(){
    for(var i = 0; i < bulletList.length; i++){
    	bulletList[i].move(0, dy); 
    	/*var elem = monkey.getX() - MONKEY_RADIUS;
    	if(bulletList[i].getX() - BULLET_RADIUS == elem){
    	    remove(bullet);
    	    remove(elem);
    	}*/
    	
        var left = getElementAt(bulletList[i].getX() - bulletList[i].getRadius(), bulletList[i].getY());
        var right = getElementAt(bulletList[i].getX() + bulletList[i].getRadius(), bulletList[i].getY());
        var top = getElementAt(bulletList[i].getX(), bulletList[i].getY() - bulletList[i].getRadius());
        var bottom = getElementAt(bulletList[i].getX(), bulletList[i].getY() + bulletList[i].getRadius());
	

        if(left == monkey){
            remove(left);
            remove(bulletList[i]);
            score++;
        } else if(right == monkey){
            remove(right);
            remove(bulletList[i]);
            score++;
        } else if(top == monkey){
            remove(top);
            remove(bulletList[i]);
            score++;
        }
        if(bulletList[i].getY() <= 0 - BULLET_RADIUS){
            stopTimer(moveBullet);
            bulletList.remove(i);
        }
    }
    
}

function checkWall(){
    var counter = 0; 
    var rows = 0; 
    for(var i = 0; i < monkeyList.length; i++){
        var monkey = monkeyList[i];

    	// Bounce off right wall
    	if(monkey.getX() + monkey.getRadius() >= getWidth()){
    	    vx = -vx;
    	    moveVertical();
    	    vy = 1;
    	}
    	// Bounce off left wall
    	if(monkey.getX() - monkey.getRadius() <= 0){
    	    vx = -vx;
    	    moveVertical();
    	    vy = 1;
    	}
    }
}
