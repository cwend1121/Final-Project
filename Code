//SPACE MONKEYS (copyright pending)
/*things to work on (problems for future us):
*moving aliens - by tomorrow, everyone use brains to fix
*space monkeys - cadence
*breaking the monkeys/aliens
*bullet limit
*/

//Constants For Asteroids 
var NUM_ROWS = 5;
var ASTEROID_RADIUS = 12;
var asteroid;
var asteroidList = []; 
var ASTEROID_TOP_OFFSET = 10;
var ASTEROID_SPACING = ASTEROID_RADIUS * 2;
var NUM_ASTEROIDS_PER_ROW = 10;
var SPACE_FOR_ASTEROIDS = getWidth() - (NUM_ASTEROIDS_PER_ROW + 1) * ASTEROID_SPACING;
var brown = new Color(128, 70, 27); 
var asteroidMoveX;
var asteroidMoveY;

var MONKEY_WIDTH = 12;
var MONKEY_LENGTH = 12;
var monkey;
var monkeyList = [];
var MONKEY_TOP_OFFSET = 10; 
var MONKEY_SPACING = MONKEY_WIDTH;

//Constants For Bullet And Ship
const  SHIP_WIDTH = 80;
const  SHIP_HEIGHT = 15;
const  SHIP_OFFSET = 30;
const BULLET_RADIUS = 2;
var bullet;
var bulletList = []; 
var helicopter = new WebImage("https://static.codehs.com/img/library/objects/helicopter.png");

//Constants For Movement 
var ship;
var bulletTimer;
var dx = 4;
var dy = -4;
var vx = 5;
var vy = 0;
var startMovement = false;
var asteroidMoveX = 5;
var asteroidMoveY = 5;
var counter = 0;

//Constants For Timers And Score
var score = 0;
var numLives = 3;
var startGame = 10;
var winner = false;
var loser = true;

function start(){
    //Set Up The Game
    setBackground();
    setAsteroids(); 
    setScore();
    livesLeft();
    setTimer(gameStart, 100);
    setTimer(moveAsteroids, 250);
    
    //Bullet And Ship Code
	drawShip();
    mouseMoveMethod(moveShip);
	mouseClickMethod(drawBullet);
}

//AddsBbackground
function setBackground(){
    var background = new Rectangle(getWidth(), getHeight());
    background.setPosition(0, 0); 
    background.setColor(Color.BLACK); 
    add(background);
    
    for(var i = 0; i < 40; i++){
        var x = Randomizer.nextInt(10, getWidth());
        var y = Randomizer.nextInt(10, getHeight());
        drawStars(x, y);
    }
}

function drawStars(x, y){
    var star = new Circle(1);
    star.setPosition(x, y);
    star.setColor(Color.WHITE);
    add(star);
}

//Sets Up Asteroids
function setAsteroids(){ 
    for (var r = 0; r < NUM_ROWS; r++){
        for (var c = 0; c < NUM_ASTEROIDS_PER_ROW; c++){
            asteroid = new Circle(ASTEROID_RADIUS);
            var asteroidX = ASTEROID_SPACING + c * (ASTEROID_RADIUS + ASTEROID_SPACING);
            var asteroidY = ASTEROID_TOP_OFFSET + r * (ASTEROID_RADIUS + ASTEROID_SPACING) + 40;
        
            asteroid.setPosition(asteroidX, asteroidY); 
            asteroid.setColor(brown); 
            add(asteroid);
            asteroidList.push(asteroid); 
        }
    }
}

function setScore(){
    var txt = new Text("Score: " + score, "20pt Arial");
    txt.setPosition(5, 30);
    txt.setColor(Color.WHITE);
    add(txt);
}

function livesLeft(){
    var txt = new Text("Lives: " + numLives, "20pt Arial");
    txt.setPosition(getWidth() - 95, 30);
    txt.setColor(Color.WHITE);
    add(txt);
/*
    helicopter.setSize(10, 10);
    var lives = helicopter;
    var lives2 = helicopter;
    var lives3 = helicopter;
    lives.setPosition (20, 20);
    lives2.setPosition(40, 20);
    lives3.setPosition(60, 20);

    if(ship.getX() == asteroid){
        numLives--;
    }
    if(numLives == 2){
        remove(lives3);
    }else if(numLives == 1){
        remove(lives2);
    }else if(numLives == 0){
        remove(lives);
        println("Game Over");
    }*/
}

function gameStart(){
    if(startGame == 10){/*
        var background = new Rectangle(getWidth(), getHeight());
        background.setPosition(0, 0); 
        background.setColor(Color.GREEN); 
        add(background);
    
        var txt = new Text("A group of space monkeys are coming to attack Earth!", "20pt Arial");
        txt.setPosition(0, 0);
        txt.setColor(Color.BLACK);
        add(txt);
    
        var txt2 = new Text("Control the helicopter and shoot them down for a prize wothy of a hero.", "20pt Arial");
        txt.setPosition(0, getHeight() / 3);
        txt.setColor(Color.BLACK);
        add(txt2);
    
        var txt3 = new Text("Don't fail or else you will die.", "20pt Arial");
        txt.setPosition(0, getHeight() / 3 + getHeight() / 3);
        txt.setColor(Color.BLACK);
        add(txt3);*/
    }
    if(startGame == 2){/*
        remove(background);
        remove(txt);
        remove(txt2);
        remove(txt3);
        
        var rect = new Rectangle(getWidth(), 30);
        rect.setPosition(0, getHeight() / 2 - 15);
        rect.setColor(Color.GREEN);
        add(rect);
    
        var txt4 = new Text("Presenting: Space Monkeys", "20pt Arial");
        txt.setPosition(getWidth() / 2 - 180, getHeight() / 2 + 9);
        txt.setColor(Color.WHITE);
        add(txt4);
    */}
    if(startGame == 0){/*
        remove(rect);
        remove(txt4);*/
        startMovement = true;
        println("You can start the game");
    }
    startGame--;
}

//Moves Asteroids 
function moveAsteroids() {
    checkWall();
    moveHorizontal();
}

function moveHorizontal() {
    for(var i = 0; i < asteroidList.length; i++) {
        var movement = asteroidList[i];
           movement.move(vx, 0);
    }
}

function moveVertical(){
    for(var i = 0; i < asteroidList.length; i++){
        var movement = asteroidList[i];
        movement.move(0, vy);
        counter++;
        if(counter == 3){
            movement.move(0, vy);
            counter = 0;
        }
    }
}

//Getting A Game Over	
function gameOver() {
	var rect = new Rectangle(getWidth(), 30);
    rect.setPosition(0, getHeight() / 2 - 15);
    rect.setColor(Color.red);
    add(rect);
    
    var txt = new Text("Game Over. You Lose.", "20pt Arial");
    txt.setPosition(getWidth() / 2 - 130, getHeight() / 2 + 9);
    txt.setColor(Color.WHITE);
    add(txt);
}

function winGame(){
    var rect = new Rectangle(getWidth(), 30);
    rect.setPosition(0, getHeight() / 2 - 15);
    rect.setColor(Color.green);
    add(rect);
    
    var txt = new Text("You Win. Welcome to the Elite.", "20pt Arial");
    txt.setPosition(getWidth() / 2 - 180, getHeight() / 2 + 9);
    txt.setColor(Color.WHITE);
    add(txt);
}

//Spaceship Code
function drawShip(){
    ship = new WebImage("https://static.codehs.com/img/library/objects/helicopter.png");
    ship.setSize(40, 40);
    ship.setPosition(getWidth()/2 - SHIP_WIDTH/2, getHeight() - SHIP_OFFSET - SHIP_HEIGHT);
    add(ship);
}

//Move Ship
function moveShip(e){
    ship.setPosition(e.getX() - SHIP_WIDTH/2, getHeight() - SHIP_OFFSET - SHIP_HEIGHT);
}

//Shoots Bullets
function drawBullet(e){
    bullet = new Circle(BULLET_RADIUS);
    bullet.setPosition(ship.getX() + 20, ship.getY());
    bullet.setBorderWidth(2);
    bullet.setBorderColor(Randomizer.nextColor());
    add(bullet);
    //if(bulletTimer == false){
        setTimer(moveBullet, 10);
        //bulletTimer = true;
    //}
    bulletList.push(bullet);
}

function moveBullet(){
    for(var i = 0; i < bulletList.length; i++){
    	bulletList[i].move(0, dy); 
    	
        var left = getElementAt(bulletList[i].getX() - bulletList[i].getRadius(), bulletList[i].getY());
        var right = getElementAt(bulletList[i].getX() + bulletList[i].getRadius(), bulletList[i].getY());
        var top = getElementAt(bulletList[i].getX(), bulletList[i].getY() - bulletList[i].getRadius());
        var bottom = getElementAt(bulletList[i].getX(), bulletList[i].getY() + bulletList[i].getRadius());
	
        if(left != bulletList[i] && left != ship && left != null){
            remove(left);
            remove(bullet);
            score++;
        } else if(right != bulletList[i] && right != ship && right != null){
            remove(right);
            remove(bullet);
            score++;
        } else if(top != bulletList[i] && top != ship && top != null){
            remove(top);
            remove(bullet);
            score++;
	    }else if(bottom != bulletList[i] && bottom != ship && bottom != null){
            remove(bottom);
            remove(bullet);
            score++;
        }
    	
        if(bulletList[i].getY() <= 0 - BULLET_RADIUS){
            stopTimer(moveBullet);
            //bulletTimer = false;
            bulletList.remove(i);
        }
    }
}

function checkWall(){
    var counter = 0; 
    var rows = 0; 
    for(var i = 0; i < asteroidList.length; i++){
        var monkey = asteroidList[i];
        var rows = 0
    	// Bounce off right wall
    	if(monkey.getX() + monkey.getRadius() >= getWidth()){
    	    vx = -vx;
    	    moveVertical();
    	    vy = 1;
    	}
    	
    	// Bounce off left wall
    	if(monkey.getX() - monkey.getRadius() <= 0){
    	    vx = -vx;
    	    moveVertical();
    	    vy = 1;
    	}
    }
}
